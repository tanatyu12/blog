{"version":3,"sources":["../../src/mediaLibrary.js"],"names":["initializeMediaLibrary","name","options","lib","handleInsert","url","store","dispatch","instance","init","subscribe","state","getState","mediaLibraryName","config","getIn","mediaLibrary","get","mediaLibraryConfig","toJS"],"mappings":";;;;AAKA;;AACA;;AACA;;;;AAEA,MAAMA,sBAAsB,GAAG,oBAAK,eAAeA,sBAAf,CAAsCC,IAAtC,EAA4CC,OAA5C,EAAqD;AACvF,QAAMC,GAAG,GAAG,+BAAgBF,IAAhB,CAAZ;;AACA,QAAMG,YAAY,GAAGC,GAAG,IAAIC,eAAMC,QAAN,CAAe,+BAAYF,GAAZ,CAAf,CAA5B;;AACA,QAAMG,QAAQ,GAAG,MAAML,GAAG,CAACM,IAAJ,CAAS;AAAEP,IAAAA,OAAF;AAAWE,IAAAA;AAAX,GAAT,CAAvB;;AACAE,iBAAMC,QAAN,CAAe,sCAAmBC,QAAnB,CAAf;AACD,CAL8B,CAA/B;;AAOAF,eAAMI,SAAN,CAAgB,MAAM;AACpB,QAAMC,KAAK,GAAGL,eAAMM,QAAN,EAAd;;AACA,QAAMC,gBAAgB,GAAGF,KAAK,CAACG,MAAN,CAAaC,KAAb,CAAmB,CAAC,eAAD,EAAkB,MAAlB,CAAnB,CAAzB;;AACA,MAAIF,gBAAgB,IAAI,CAACF,KAAK,CAACK,YAAN,CAAmBC,GAAnB,CAAuB,iBAAvB,CAAzB,EAAoE;AAClE,UAAMC,kBAAkB,GAAGP,KAAK,CAACG,MAAN,CAAaG,GAAb,CAAiB,eAAjB,EAAkCE,IAAlC,EAA3B;AACAnB,IAAAA,sBAAsB,CAACa,gBAAD,EAAmBK,kBAAnB,CAAtB;AACD;AACF,CAPD","sourcesContent":["/**\n * This module is currently concerned only with external media libraries\n * registered via `registerMediaLibrary`.\n */\nimport { once } from 'lodash';\nimport { getMediaLibrary } from 'Lib/registry';\nimport store from 'ReduxStore';\nimport { createMediaLibrary, insertMedia } from 'Actions/mediaLibrary';\n\nconst initializeMediaLibrary = once(async function initializeMediaLibrary(name, options) {\n  const lib = getMediaLibrary(name);\n  const handleInsert = url => store.dispatch(insertMedia(url));\n  const instance = await lib.init({ options, handleInsert });\n  store.dispatch(createMediaLibrary(instance));\n});\n\nstore.subscribe(() => {\n  const state = store.getState();\n  const mediaLibraryName = state.config.getIn(['media_library', 'name']);\n  if (mediaLibraryName && !state.mediaLibrary.get('externalLibrary')) {\n    const mediaLibraryConfig = state.config.get('media_library').toJS();\n    initializeMediaLibrary(mediaLibraryName, mediaLibraryConfig);\n  }\n});\n"],"file":"mediaLibrary.js"}