{"version":3,"sources":["../../../src/reducers/mediaLibrary.js"],"names":["defaultState","isVisible","showMediaButton","controlMedia","displayURLs","mediaLibrary","state","action","type","MEDIA_LIBRARY_CREATE","withMutations","map","set","payload","enableStandalone","MEDIA_LIBRARY_OPEN","controlID","forImage","privateUpload","privateUploadChanged","get","canInsert","MEDIA_LIBRARY_CLOSE","MEDIA_INSERT","mediaPath","setIn","MEDIA_REMOVE_INSERTED","MEDIA_LOAD_REQUEST","page","MEDIA_LOAD_SUCCESS","files","canPaginate","dynamicSearch","dynamicSearchQuery","filesWithKeys","file","key","length","updatedFiles","concat","MEDIA_LOAD_FAILURE","MEDIA_PERSIST_REQUEST","MEDIA_PERSIST_SUCCESS","fileWithKey","MEDIA_PERSIST_FAILURE","MEDIA_DELETE_REQUEST","MEDIA_DELETE_SUCCESS","id","filter","deleteIn","MEDIA_DELETE_FAILURE","MEDIA_DISPLAY_URL_REQUEST","MEDIA_DISPLAY_URL_SUCCESS","displayURLPath","url","MEDIA_DISPLAY_URL_FAILURE","err"],"mappings":"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","sourcesContent":["import { Map } from 'immutable';\nimport uuid from 'uuid/v4';\nimport {\n  MEDIA_LIBRARY_OPEN,\n  MEDIA_LIBRARY_CLOSE,\n  MEDIA_LIBRARY_CREATE,\n  MEDIA_INSERT,\n  MEDIA_REMOVE_INSERTED,\n  MEDIA_LOAD_REQUEST,\n  MEDIA_LOAD_SUCCESS,\n  MEDIA_LOAD_FAILURE,\n  MEDIA_PERSIST_REQUEST,\n  MEDIA_PERSIST_SUCCESS,\n  MEDIA_PERSIST_FAILURE,\n  MEDIA_DELETE_REQUEST,\n  MEDIA_DELETE_SUCCESS,\n  MEDIA_DELETE_FAILURE,\n  MEDIA_DISPLAY_URL_REQUEST,\n  MEDIA_DISPLAY_URL_SUCCESS,\n  MEDIA_DISPLAY_URL_FAILURE,\n} from 'Actions/mediaLibrary';\n\nconst defaultState = {\n  isVisible: false,\n  showMediaButton: true,\n  controlMedia: Map(),\n  displayURLs: Map(),\n};\n\nconst mediaLibrary = (state = Map(defaultState), action) => {\n  switch (action.type) {\n    case MEDIA_LIBRARY_CREATE:\n      return state.withMutations(map => {\n        map.set('externalLibrary', action.payload);\n        map.set('showMediaButton', action.payload.enableStandalone());\n      });\n    case MEDIA_LIBRARY_OPEN: {\n      const { controlID, forImage, privateUpload } = action.payload;\n      const privateUploadChanged = state.get('privateUpload') !== privateUpload;\n      if (privateUploadChanged) {\n        return Map({\n          isVisible: true,\n          forImage,\n          controlID,\n          canInsert: !!controlID,\n          privateUpload,\n          controlMedia: Map(),\n        });\n      }\n      return state.withMutations(map => {\n        map.set('isVisible', true);\n        map.set('forImage', forImage);\n        map.set('controlID', controlID);\n        map.set('canInsert', !!controlID);\n        map.set('privateUpload', privateUpload);\n      });\n    }\n    case MEDIA_LIBRARY_CLOSE:\n      return state.set('isVisible', false);\n    case MEDIA_INSERT: {\n      const { mediaPath } = action.payload;\n      const controlID = state.get('controlID');\n      return state.withMutations(map => {\n        map.setIn(['controlMedia', controlID], mediaPath);\n      });\n    }\n    case MEDIA_REMOVE_INSERTED: {\n      const controlID = action.payload.controlID;\n      return state.setIn(['controlMedia', controlID], '');\n    }\n    case MEDIA_LOAD_REQUEST:\n      return state.withMutations(map => {\n        map.set('isLoading', true);\n        map.set('isPaginating', action.payload.page > 1);\n      });\n    case MEDIA_LOAD_SUCCESS: {\n      const {\n        files = [],\n        page,\n        canPaginate,\n        dynamicSearch,\n        dynamicSearchQuery,\n        privateUpload,\n      } = action.payload;\n      const privateUploadChanged = state.get('privateUpload') !== privateUpload;\n\n      if (privateUploadChanged) {\n        return state;\n      }\n\n      const filesWithKeys = files.map(file => ({ ...file, key: uuid() }));\n      return state.withMutations(map => {\n        map.set('isLoading', false);\n        map.set('isPaginating', false);\n        map.set('page', page);\n        map.set('hasNextPage', canPaginate && files.length > 0);\n        map.set('dynamicSearch', dynamicSearch);\n        map.set('dynamicSearchQuery', dynamicSearchQuery);\n        map.set('dynamicSearchActive', !!dynamicSearchQuery);\n        if (page && page > 1) {\n          const updatedFiles = map.get('files').concat(filesWithKeys);\n          map.set('files', updatedFiles);\n        } else {\n          map.set('files', filesWithKeys);\n        }\n      });\n    }\n    case MEDIA_LOAD_FAILURE: {\n      const privateUploadChanged = state.get('privateUpload') !== action.payload.privateUpload;\n      if (privateUploadChanged) {\n        return state;\n      }\n      return state.set('isLoading', false);\n    }\n    case MEDIA_PERSIST_REQUEST:\n      return state.set('isPersisting', true);\n    case MEDIA_PERSIST_SUCCESS: {\n      const { file, privateUpload } = action.payload;\n      const privateUploadChanged = state.get('privateUpload') !== privateUpload;\n      if (privateUploadChanged) {\n        return state;\n      }\n      return state.withMutations(map => {\n        const fileWithKey = { ...file, key: uuid() };\n        const updatedFiles = [fileWithKey, ...map.get('files')];\n        map.set('files', updatedFiles);\n        map.set('isPersisting', false);\n      });\n    }\n    case MEDIA_PERSIST_FAILURE: {\n      const privateUploadChanged = state.get('privateUpload') !== action.payload.privateUpload;\n      if (privateUploadChanged) {\n        return state;\n      }\n      return state.set('isPersisting', false);\n    }\n    case MEDIA_DELETE_REQUEST:\n      return state.set('isDeleting', true);\n    case MEDIA_DELETE_SUCCESS: {\n      const { id, key, privateUpload } = action.payload.file;\n      const privateUploadChanged = state.get('privateUpload') !== privateUpload;\n      if (privateUploadChanged) {\n        return state;\n      }\n      return state.withMutations(map => {\n        const updatedFiles = map.get('files').filter(file => file.key !== key);\n        map.set('files', updatedFiles);\n        map.deleteIn(['displayURLs', id]);\n        map.set('isDeleting', false);\n      });\n    }\n    case MEDIA_DELETE_FAILURE: {\n      const privateUploadChanged = state.get('privateUpload') !== action.payload.privateUpload;\n      if (privateUploadChanged) {\n        return state;\n      }\n      return state.set('isDeleting', false);\n    }\n\n    case MEDIA_DISPLAY_URL_REQUEST:\n      return state.setIn(['displayURLs', action.payload.key, 'isFetching'], true);\n\n    case MEDIA_DISPLAY_URL_SUCCESS: {\n      const displayURLPath = ['displayURLs', action.payload.key];\n      return state\n        .setIn([...displayURLPath, 'isFetching'], false)\n        .setIn([...displayURLPath, 'url'], action.payload.url);\n    }\n\n    case MEDIA_DISPLAY_URL_FAILURE: {\n      const displayURLPath = ['displayURLs', action.payload.key];\n      return (\n        state\n          .setIn([...displayURLPath, 'isFetching'], false)\n          // make sure that err is set so the CMS won't attempt to load\n          // the image again\n          .setIn([...displayURLPath, 'err'], action.payload.err || true)\n          .deleteIn([...displayURLPath, 'url'])\n      );\n    }\n    default:\n      return state;\n  }\n};\n\nexport default mediaLibrary;\n"],"file":"mediaLibrary.js"}