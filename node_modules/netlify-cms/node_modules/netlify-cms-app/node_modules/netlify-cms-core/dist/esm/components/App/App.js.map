{"version":3,"sources":["../../../../src/components/App/App.js"],"names":["TopBarProgress","config","barColors","colors","active","shadowBlur","barThickness","AppMainContainer","ErrorContainer","ErrorCodeBlock","App","React","Component","configError","t","props","get","componentDidMount","loadConfig","handleLogin","credentials","loginUser","authenticating","auth","backend","Toast","createElement","authComponent","onLogin","bind","error","isFetching","inProgress","siteId","getIn","base_url","authEndpoint","clearHash","history","replace","handleLinkClick","event","handler","preventDefault","args","render","user","collections","logoutUser","publishMode","useMediaLibrary","openMediaLibrary","showMediaButton","defaultPath","first","hasWorkflow","EDITORIAL_WORKFLOW","createNewEntry","Workflow","Collection","Editor","NotFoundPage","ImmutablePropTypes","map","orderedMap","PropTypes","func","isRequired","bool","oneOf","SIMPLE","string","mapStateToProps","state","globalUI","mediaLibrary","mapDispatchToProps","module"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAEAA,sCAAeC,MAAf,CAAsB;AACpBC,EAAAA,SAAS,EAAE;AACT,SAAKC,4BAAOC,MADH;AAET,WAAOD,4BAAOC;AAFL,GADS;AAKpBC,EAAAA,UAAU,EAAE,CALQ;AAMpBC,EAAAA,YAAY,EAAE;AANM,CAAtB;;AASA,MAAMC,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAtB;AAMA,MAAMC,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAApB;AAIA,MAAMC,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAApB;;AAMA,MAAMC,GAAN,SAAkBC,eAAMC,SAAxB,CAAkC;AAkBhCC,EAAAA,WAAW,CAACZ,MAAD,EAAS;AAClB,UAAMa,CAAC,GAAG,KAAKC,KAAL,CAAWD,CAArB;AACA,WACE,6BAAC,cAAD,QACE,yCAAKA,CAAC,CAAC,qBAAD,CAAN,CADF,EAEE,0CACE,6CAASA,CAAC,CAAC,sBAAD,CAAV,MADF,EAEE,6BAAC,cAAD,QAAiBb,MAAM,CAACe,GAAP,CAAW,OAAX,CAAjB,CAFF,EAGE,2CAAOF,CAAC,CAAC,wBAAD,CAAR,CAHF,CAFF,CADF;AAUD;;AAEDG,EAAAA,iBAAiB,GAAG;AAAA,UACVC,UADU,GACK,KAAKH,KADV,CACVG,UADU;AAElBA,IAAAA,UAAU;AACX;;AAEDC,EAAAA,WAAW,CAACC,WAAD,EAAc;AACvB,SAAKL,KAAL,CAAWM,SAAX,CAAqBD,WAArB;AACD;;AAEDE,EAAAA,cAAc,GAAG;AAAA,wBACK,KAAKP,KADV;AAAA,UACPQ,IADO,eACPA,IADO;AAAA,UACDT,CADC,eACDA,CADC;AAEf,UAAMU,OAAO,GAAG,6BAAe,KAAKT,KAAL,CAAWd,MAA1B,CAAhB;;AAEA,QAAIuB,OAAO,IAAI,IAAf,EAAqB;AACnB,aACE,0CACE,yCAAKV,CAAC,CAAC,wBAAD,CAAN,CADF,CADF;AAKD;;AAED,WACE,0CACE,6BAAC,0BAAD;AAAQ,MAAA,eAAe,EAAEW;AAAzB,MADF,EAEGd,eAAMe,aAAN,CAAoBF,OAAO,CAACG,aAAR,EAApB,EAA6C;AAC5CC,MAAAA,OAAO,EAAE,KAAKT,WAAL,CAAiBU,IAAjB,CAAsB,IAAtB,CADmC;AAE5CC,MAAAA,KAAK,EAAEP,IAAI,IAAIA,IAAI,CAACP,GAAL,CAAS,OAAT,CAF6B;AAG5Ce,MAAAA,UAAU,EAAER,IAAI,IAAIA,IAAI,CAACP,GAAL,CAAS,YAAT,CAHwB;AAI5CgB,MAAAA,UAAU,EAAGT,IAAI,IAAIA,IAAI,CAACP,GAAL,CAAS,YAAT,CAAT,IAAoC,KAJJ;AAK5CiB,MAAAA,MAAM,EAAE,KAAKlB,KAAL,CAAWd,MAAX,CAAkBiC,KAAlB,CAAwB,CAAC,SAAD,EAAY,aAAZ,CAAxB,CALoC;AAM5CC,MAAAA,QAAQ,EAAE,KAAKpB,KAAL,CAAWd,MAAX,CAAkBiC,KAAlB,CAAwB,CAAC,SAAD,EAAY,UAAZ,CAAxB,EAAiD,IAAjD,CANkC;AAO5CE,MAAAA,YAAY,EAAE,KAAKrB,KAAL,CAAWd,MAAX,CAAkBiC,KAAlB,CAAwB,CAAC,SAAD,EAAY,eAAZ,CAAxB,CAP8B;AAQ5CjC,MAAAA,MAAM,EAAE,KAAKc,KAAL,CAAWd,MARyB;AAS5CoC,MAAAA,SAAS,EAAE,MAAMC,iBAAQC,OAAR,CAAgB,GAAhB;AAT2B,KAA7C,CAFH,CADF;AAgBD;;AAEDC,EAAAA,eAAe,CAACC,KAAD,EAAQC,OAAR,EAA0B;AACvCD,IAAAA,KAAK,CAACE,cAAN;;AADuC,sCAANC,IAAM;AAANA,MAAAA,IAAM;AAAA;;AAEvCF,IAAAA,OAAO,CAAC,GAAGE,IAAJ,CAAP;AACD;;AAEDC,EAAAA,MAAM,GAAG;AAAA,yBAYH,KAAK9B,KAZF;AAAA,UAEL+B,IAFK,gBAELA,IAFK;AAAA,UAGL7C,MAHK,gBAGLA,MAHK;AAAA,UAIL8C,WAJK,gBAILA,WAJK;AAAA,UAKLC,UALK,gBAKLA,UALK;AAAA,UAMLjB,UANK,gBAMLA,UANK;AAAA,UAOLkB,WAPK,gBAOLA,WAPK;AAAA,UAQLC,eARK,gBAQLA,eARK;AAAA,UASLC,gBATK,gBASLA,gBATK;AAAA,UAULrC,CAVK,gBAULA,CAVK;AAAA,UAWLsC,eAXK,gBAWLA,eAXK;;AAcP,QAAInD,MAAM,KAAK,IAAf,EAAqB;AACnB,aAAO,IAAP;AACD;;AAED,QAAIA,MAAM,CAACe,GAAP,CAAW,OAAX,CAAJ,EAAyB;AACvB,aAAO,KAAKH,WAAL,CAAiBZ,MAAjB,CAAP;AACD;;AAED,QAAIA,MAAM,CAACe,GAAP,CAAW,YAAX,CAAJ,EAA8B;AAC5B,aAAO,6BAAC,2BAAD;AAAQ,QAAA,MAAM;AAAd,SAAgBF,CAAC,CAAC,uBAAD,CAAjB,CAAP;AACD;;AAED,QAAIgC,IAAI,IAAI,IAAZ,EAAkB;AAChB,aAAO,KAAKxB,cAAL,CAAoBR,CAApB,CAAP;AACD;;AAED,UAAMuC,WAAW,GAAI,gBAAeN,WAAW,CAACO,KAAZ,GAAoBtC,GAApB,CAAwB,MAAxB,CAAgC,EAApE;AACA,UAAMuC,WAAW,GAAGN,WAAW,KAAKO,gCAApC;AAEA,WACE,4DACE,6BAAC,0BAAD;AAAQ,MAAA,eAAe,EAAE/B;AAAzB,MADF,EAEE,6BAAC,eAAD;AACE,MAAA,IAAI,EAAEqB,IADR;AAEE,MAAA,WAAW,EAAEC,WAFf;AAGE,MAAA,kBAAkB,EAAEU,2BAHtB;AAIE,MAAA,aAAa,EAAET,UAJjB;AAKE,MAAA,gBAAgB,EAAEG,gBALpB;AAME,MAAA,WAAW,EAAEI,WANf;AAOE,MAAA,UAAU,EAAEtD,MAAM,CAACe,GAAP,CAAW,aAAX,CAPd;AAQE,MAAA,eAAe,EAAEoC;AARnB,MAFF,EAYE,6BAAC,gBAAD,QACGrB,UAAU,IAAI,6BAAC,qCAAD,OADjB,EAEE,6BAAC,sBAAD,QACE,6BAAC,wBAAD;AAAU,MAAA,KAAK,MAAf;AAAgB,MAAA,IAAI,EAAC,GAArB;AAAyB,MAAA,EAAE,EAAEsB;AAA7B,MADF,EAEE,6BAAC,wBAAD;AAAU,MAAA,KAAK,MAAf;AAAgB,MAAA,IAAI,EAAC,UAArB;AAAgC,MAAA,EAAE,EAAEA;AAApC,MAFF,EAGGE,WAAW,GAAG,6BAAC,qBAAD;AAAO,MAAA,IAAI,EAAC,WAAZ;AAAwB,MAAA,SAAS,EAAEG;AAAnC,MAAH,GAAqD,IAHnE,EAIE,6BAAC,qBAAD;AAAO,MAAA,KAAK,MAAZ;AAAa,MAAA,IAAI,EAAC,oBAAlB;AAAuC,MAAA,SAAS,EAAEC;AAAlD,MAJF,EAKE,6BAAC,qBAAD;AACE,MAAA,IAAI,EAAC,wBADP;AAEE,MAAA,MAAM,EAAE5C,KAAK,IAAI,6BAAC,eAAD,eAAYA,KAAZ;AAAmB,QAAA,SAAS;AAA5B;AAFnB,MALF,EASE,6BAAC,qBAAD;AAAO,MAAA,IAAI,EAAC,kCAAZ;AAA+C,MAAA,SAAS,EAAE6C;AAA1D,MATF,EAUE,6BAAC,qBAAD;AACE,MAAA,IAAI,EAAC,qBADP;AAEE,MAAA,MAAM,EAAE7C,KAAK,IAAI,6BAAC,mBAAD,eAAgBA,KAAhB;AAAuB,QAAA,eAAe;AAAtC;AAFnB,MAVF,EAcE,6BAAC,qBAAD;AAAO,MAAA,SAAS,EAAE8C;AAAlB,MAdF,CAFF,EAkBGX,eAAe,GAAG,6BAAC,qBAAD,OAAH,GAAsB,IAlBxC,CAZF,CADF;AAmCD;;AAhJ+B;;gBAA5BxC,G,eACe;AACjBa,EAAAA,IAAI,EAAEuC,iCAAmBC,GADR;AAEjB9D,EAAAA,MAAM,EAAE6D,iCAAmBC,GAFV;AAGjBhB,EAAAA,WAAW,EAAEe,iCAAmBE,UAHf;AAIjB9C,EAAAA,UAAU,EAAE+C,mBAAUC,IAAV,CAAeC,UAJV;AAKjB9C,EAAAA,SAAS,EAAE4C,mBAAUC,IAAV,CAAeC,UALT;AAMjBnB,EAAAA,UAAU,EAAEiB,mBAAUC,IAAV,CAAeC,UANV;AAOjBrB,EAAAA,IAAI,EAAEgB,iCAAmBC,GAPR;AAQjBhC,EAAAA,UAAU,EAAEkC,mBAAUG,IAAV,CAAeD,UARV;AASjBlB,EAAAA,WAAW,EAAEgB,mBAAUI,KAAV,CAAgB,CAACC,oBAAD,EAASd,gCAAT,CAAhB,CATI;AAUjBvB,EAAAA,MAAM,EAAEgC,mBAAUM,MAVD;AAWjBrB,EAAAA,eAAe,EAAEe,mBAAUG,IAXV;AAYjBjB,EAAAA,gBAAgB,EAAEc,mBAAUC,IAAV,CAAeC,UAZhB;AAajBf,EAAAA,eAAe,EAAEa,mBAAUG,IAbV;AAcjBtD,EAAAA,CAAC,EAAEmD,mBAAUC,IAAV,CAAeC;AAdD,C;;AAkJrB,SAASK,eAAT,CAAyBC,KAAzB,EAAgC;AAAA,QACtBlD,IADsB,GACgCkD,KADhC,CACtBlD,IADsB;AAAA,QAChBtB,MADgB,GACgCwE,KADhC,CAChBxE,MADgB;AAAA,QACR8C,WADQ,GACgC0B,KADhC,CACR1B,WADQ;AAAA,QACK2B,QADL,GACgCD,KADhC,CACKC,QADL;AAAA,QACeC,YADf,GACgCF,KADhC,CACeE,YADf;AAE9B,QAAM7B,IAAI,GAAGvB,IAAI,IAAIA,IAAI,CAACP,GAAL,CAAS,MAAT,CAArB;AACA,QAAMe,UAAU,GAAG2C,QAAQ,CAAC1D,GAAT,CAAa,YAAb,CAAnB;AACA,QAAMiC,WAAW,GAAGhD,MAAM,IAAIA,MAAM,CAACe,GAAP,CAAW,cAAX,CAA9B;AACA,QAAMkC,eAAe,GAAG,CAACyB,YAAY,CAAC3D,GAAb,CAAiB,iBAAjB,CAAzB;AACA,QAAMoC,eAAe,GAAGuB,YAAY,CAAC3D,GAAb,CAAiB,iBAAjB,CAAxB;AACA,SAAO;AACLO,IAAAA,IADK;AAELtB,IAAAA,MAFK;AAGL8C,IAAAA,WAHK;AAILD,IAAAA,IAJK;AAKLf,IAAAA,UALK;AAMLkB,IAAAA,WANK;AAOLG,IAAAA,eAPK;AAQLF,IAAAA;AARK,GAAP;AAUD;;AAED,MAAM0B,kBAAkB,GAAG;AACzBzB,EAAAA,gBAAgB,EAAhBA,8BADyB;AAEzBjC,EAAAA,UAAU,EAAVA,kBAFyB;AAGzBG,EAAAA,SAAS,EAATA,eAHyB;AAIzB2B,EAAAA,UAAU,EAAVA;AAJyB,CAA3B;;eAOe,yBAAI6B,MAAJ,EACb,yBACEL,eADF,EAEEI,kBAFF,EAGE,gCAAYlE,GAAZ,CAHF,CADa,C","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\nimport { hot } from 'react-hot-loader';\nimport { translate } from 'react-polyglot';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport styled from '@emotion/styled';\nimport { connect } from 'react-redux';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport { Notifs } from 'redux-notifications';\nimport TopBarProgress from 'react-topbar-progress-indicator';\nimport { loadConfig } from 'Actions/config';\nimport { loginUser, logoutUser } from 'Actions/auth';\nimport { currentBackend } from 'coreSrc/backend';\nimport { createNewEntry } from 'Actions/collections';\nimport { openMediaLibrary } from 'Actions/mediaLibrary';\nimport MediaLibrary from 'MediaLibrary/MediaLibrary';\nimport { Toast } from 'UI';\nimport { Loader, colors } from 'netlify-cms-ui-default';\nimport history from 'Routing/history';\nimport { SIMPLE, EDITORIAL_WORKFLOW } from 'Constants/publishModes';\nimport Collection from 'Collection/Collection';\nimport Workflow from 'Workflow/Workflow';\nimport Editor from 'Editor/Editor';\nimport NotFoundPage from './NotFoundPage';\nimport Header from './Header';\n\nTopBarProgress.config({\n  barColors: {\n    '0': colors.active,\n    '1.0': colors.active,\n  },\n  shadowBlur: 0,\n  barThickness: 2,\n});\n\nconst AppMainContainer = styled.div`\n  min-width: 800px;\n  max-width: 1440px;\n  margin: 0 auto;\n`;\n\nconst ErrorContainer = styled.div`\n  margin: 20px;\n`;\n\nconst ErrorCodeBlock = styled.pre`\n  margin-left: 20px;\n  font-size: 15px;\n  line-height: 1.5;\n`;\n\nclass App extends React.Component {\n  static propTypes = {\n    auth: ImmutablePropTypes.map,\n    config: ImmutablePropTypes.map,\n    collections: ImmutablePropTypes.orderedMap,\n    loadConfig: PropTypes.func.isRequired,\n    loginUser: PropTypes.func.isRequired,\n    logoutUser: PropTypes.func.isRequired,\n    user: ImmutablePropTypes.map,\n    isFetching: PropTypes.bool.isRequired,\n    publishMode: PropTypes.oneOf([SIMPLE, EDITORIAL_WORKFLOW]),\n    siteId: PropTypes.string,\n    useMediaLibrary: PropTypes.bool,\n    openMediaLibrary: PropTypes.func.isRequired,\n    showMediaButton: PropTypes.bool,\n    t: PropTypes.func.isRequired,\n  };\n\n  configError(config) {\n    const t = this.props.t;\n    return (\n      <ErrorContainer>\n        <h1>{t('app.app.errorHeader')}</h1>\n        <div>\n          <strong>{t('app.app.configErrors')}:</strong>\n          <ErrorCodeBlock>{config.get('error')}</ErrorCodeBlock>\n          <span>{t('app.app.checkConfigYml')}</span>\n        </div>\n      </ErrorContainer>\n    );\n  }\n\n  componentDidMount() {\n    const { loadConfig } = this.props;\n    loadConfig();\n  }\n\n  handleLogin(credentials) {\n    this.props.loginUser(credentials);\n  }\n\n  authenticating() {\n    const { auth, t } = this.props;\n    const backend = currentBackend(this.props.config);\n\n    if (backend == null) {\n      return (\n        <div>\n          <h1>{t('app.app.waitingBackend')}</h1>\n        </div>\n      );\n    }\n\n    return (\n      <div>\n        <Notifs CustomComponent={Toast} />\n        {React.createElement(backend.authComponent(), {\n          onLogin: this.handleLogin.bind(this),\n          error: auth && auth.get('error'),\n          isFetching: auth && auth.get('isFetching'),\n          inProgress: (auth && auth.get('isFetching')) || false,\n          siteId: this.props.config.getIn(['backend', 'site_domain']),\n          base_url: this.props.config.getIn(['backend', 'base_url'], null),\n          authEndpoint: this.props.config.getIn(['backend', 'auth_endpoint']),\n          config: this.props.config,\n          clearHash: () => history.replace('/'),\n        })}\n      </div>\n    );\n  }\n\n  handleLinkClick(event, handler, ...args) {\n    event.preventDefault();\n    handler(...args);\n  }\n\n  render() {\n    const {\n      user,\n      config,\n      collections,\n      logoutUser,\n      isFetching,\n      publishMode,\n      useMediaLibrary,\n      openMediaLibrary,\n      t,\n      showMediaButton,\n    } = this.props;\n\n    if (config === null) {\n      return null;\n    }\n\n    if (config.get('error')) {\n      return this.configError(config);\n    }\n\n    if (config.get('isFetching')) {\n      return <Loader active>{t('app.app.loadingConfig')}</Loader>;\n    }\n\n    if (user == null) {\n      return this.authenticating(t);\n    }\n\n    const defaultPath = `/collections/${collections.first().get('name')}`;\n    const hasWorkflow = publishMode === EDITORIAL_WORKFLOW;\n\n    return (\n      <>\n        <Notifs CustomComponent={Toast} />\n        <Header\n          user={user}\n          collections={collections}\n          onCreateEntryClick={createNewEntry}\n          onLogoutClick={logoutUser}\n          openMediaLibrary={openMediaLibrary}\n          hasWorkflow={hasWorkflow}\n          displayUrl={config.get('display_url')}\n          showMediaButton={showMediaButton}\n        />\n        <AppMainContainer>\n          {isFetching && <TopBarProgress />}\n          <Switch>\n            <Redirect exact from=\"/\" to={defaultPath} />\n            <Redirect exact from=\"/search/\" to={defaultPath} />\n            {hasWorkflow ? <Route path=\"/workflow\" component={Workflow} /> : null}\n            <Route exact path=\"/collections/:name\" component={Collection} />\n            <Route\n              path=\"/collections/:name/new\"\n              render={props => <Editor {...props} newRecord />}\n            />\n            <Route path=\"/collections/:name/entries/:slug\" component={Editor} />\n            <Route\n              path=\"/search/:searchTerm\"\n              render={props => <Collection {...props} isSearchResults />}\n            />\n            <Route component={NotFoundPage} />\n          </Switch>\n          {useMediaLibrary ? <MediaLibrary /> : null}\n        </AppMainContainer>\n      </>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  const { auth, config, collections, globalUI, mediaLibrary } = state;\n  const user = auth && auth.get('user');\n  const isFetching = globalUI.get('isFetching');\n  const publishMode = config && config.get('publish_mode');\n  const useMediaLibrary = !mediaLibrary.get('externalLibrary');\n  const showMediaButton = mediaLibrary.get('showMediaButton');\n  return {\n    auth,\n    config,\n    collections,\n    user,\n    isFetching,\n    publishMode,\n    showMediaButton,\n    useMediaLibrary,\n  };\n}\n\nconst mapDispatchToProps = {\n  openMediaLibrary,\n  loadConfig,\n  loginUser,\n  logoutUser,\n};\n\nexport default hot(module)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps,\n  )(translate()(App)),\n);\n"],"file":"App.js"}