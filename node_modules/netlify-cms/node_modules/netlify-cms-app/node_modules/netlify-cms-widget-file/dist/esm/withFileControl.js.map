{"version":3,"sources":["../../src/withFileControl.js"],"names":["MAX_DISPLAY_LENGTH","ImageWrapper","borders","textField","lengths","borderRadius","effects","checkerboard","shadows","inset","Image","MultiImageWrapper","FileLink","FileLinks","FileLinkList","FileWidgetButton","buttons","button","components","badge","FileWidgetButtonRemove","badgeDanger","isMultiple","value","Array","isArray","List","isList","warnDeprecatedOptions","field","console","warn","oneLine","get","withFileControl","forImage","FileControl","React","Component","constructor","props","e","onOpenMediaLibrary","preventDefault","mediaLibraryFieldOptions","hasIn","getIn","controlID","privateUpload","allowMultiple","config","onClearMediaControl","onChange","size","length","text","substring","map","val","renderFileLink","getAsset","subject","renderImages","renderFileLinks","handleChange","handleRemove","article","shouldComponentUpdate","nextProps","mediaPath","mediaPaths","componentDidUpdate","onRemoveInsertedMedia","componentWillUnmount","onRemoveMediaControl","render","classNameWrapper","renderSelection","renderNoSelection","PropTypes","object","isRequired","func","ImmutablePropTypes","onAddAsset","string","oneOfType","arrayOf"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport styled from '@emotion/styled';\nimport { Map, List } from 'immutable';\nimport { once } from 'lodash';\nimport uuid from 'uuid/v4';\nimport { oneLine } from 'common-tags';\nimport { lengths, components, buttons, borders, effects, shadows } from 'netlify-cms-ui-default';\n\nconst MAX_DISPLAY_LENGTH = 50;\n\nconst ImageWrapper = styled.div`\n  flex-basis: 155px;\n  width: 155px;\n  height: 100px;\n  margin-right: 20px;\n  margin-bottom: 20px;\n  border: ${borders.textField};\n  border-radius: ${lengths.borderRadius};\n  ${effects.checkerboard};\n  ${shadows.inset};\n`;\n\nconst Image = styled.img`\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n`;\n\nconst MultiImageWrapper = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst FileLink = styled.a`\n  margin-bottom: 20px;\n  font-weight: normal;\n  color: inherit;\n\n  &:hover,\n  &:active,\n  &:focus {\n    text-decoration: underline;\n  }\n`;\n\nconst FileLinks = styled.div`\n  margin-bottom: 12px;\n`;\n\nconst FileLinkList = styled.ul`\n  list-style-type: none;\n`;\n\nconst FileWidgetButton = styled.button`\n  ${buttons.button};\n  ${components.badge};\n`;\n\nconst FileWidgetButtonRemove = styled.button`\n  ${buttons.button};\n  ${components.badgeDanger};\n  margin-top: 12px;\n`;\n\nfunction isMultiple(value) {\n  return Array.isArray(value) || List.isList(value);\n}\n\nconst warnDeprecatedOptions = once(field =>\n  console.warn(oneLine`\n  Netlify CMS config: ${field.get('name')} field: property \"options\" has been deprecated for the\n  ${field.get('widget')} widget and will be removed in the next major release. Rather than\n  \\`field.options.media_library\\`, apply media library options for this widget under\n  \\`field.media_library\\`.\n`),\n);\n\nexport default function withFileControl({ forImage } = {}) {\n  return class FileControl extends React.Component {\n    static propTypes = {\n      field: PropTypes.object.isRequired,\n      getAsset: PropTypes.func.isRequired,\n      mediaPaths: ImmutablePropTypes.map.isRequired,\n      onAddAsset: PropTypes.func.isRequired,\n      onChange: PropTypes.func.isRequired,\n      onRemoveInsertedMedia: PropTypes.func.isRequired,\n      onOpenMediaLibrary: PropTypes.func.isRequired,\n      onClearMediaControl: PropTypes.func.isRequired,\n      onRemoveMediaControl: PropTypes.func.isRequired,\n      classNameWrapper: PropTypes.string.isRequired,\n      value: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\n    };\n\n    static defaultProps = {\n      value: '',\n    };\n\n    constructor(props) {\n      super(props);\n      this.controlID = uuid();\n    }\n\n    shouldComponentUpdate(nextProps) {\n      /**\n       * Always update if the value changes.\n       */\n      if (this.props.value !== nextProps.value) {\n        return true;\n      }\n\n      /**\n       * If there is a media path for this control in the state object, and that\n       * path is different than the value in `nextProps`, update.\n       */\n      const mediaPath = nextProps.mediaPaths.get(this.controlID);\n      if (mediaPath && nextProps.value !== mediaPath) {\n        return true;\n      }\n\n      return false;\n    }\n\n    componentDidUpdate() {\n      const { mediaPaths, value, onRemoveInsertedMedia, onChange } = this.props;\n      const mediaPath = mediaPaths.get(this.controlID);\n      if (mediaPath && mediaPath !== value) {\n        onChange(mediaPath);\n      } else if (mediaPath && mediaPath === value) {\n        onRemoveInsertedMedia(this.controlID);\n      }\n    }\n\n    componentWillUnmount() {\n      this.props.onRemoveMediaControl(this.controlID);\n    }\n\n    handleChange = e => {\n      const { field, onOpenMediaLibrary, value } = this.props;\n      e.preventDefault();\n      let mediaLibraryFieldOptions;\n\n      /**\n       * `options` hash as a general field property is deprecated, only used\n       * when external media libraries were first introduced. Not to be\n       * confused with `options` for the select widget, which serves a different\n       * purpose.\n       */\n      if (field.hasIn(['options', 'media_library'])) {\n        warnDeprecatedOptions(field);\n        mediaLibraryFieldOptions = field.getIn(['options', 'media_library'], Map());\n      } else {\n        mediaLibraryFieldOptions = field.get('media_library', Map());\n      }\n\n      return onOpenMediaLibrary({\n        controlID: this.controlID,\n        forImage,\n        privateUpload: field.get('private'),\n        value,\n        allowMultiple: !!mediaLibraryFieldOptions.get('allow_multiple', true),\n        config: mediaLibraryFieldOptions.get('config'),\n      });\n    };\n\n    handleRemove = e => {\n      e.preventDefault();\n      this.props.onClearMediaControl(this.controlID);\n      return this.props.onChange('');\n    };\n\n    renderFileLink = value => {\n      const size = MAX_DISPLAY_LENGTH;\n      if (!value || value.length <= size) {\n        return value;\n      }\n      const text = `${value.substring(0, size / 2)}\\u2026${value.substring(\n        value.length - size / 2 + 1,\n        value.length,\n      )}`;\n      return (\n        <FileLink href={value} rel=\"noopener\" target=\"_blank\">\n          {text}\n        </FileLink>\n      );\n    };\n\n    renderFileLinks = () => {\n      const { value } = this.props;\n\n      if (isMultiple(value)) {\n        return (\n          <FileLinks>\n            <FileLinkList>\n              {value.map(val => (\n                <li key={val}>{this.renderFileLink(val)}</li>\n              ))}\n            </FileLinkList>\n          </FileLinks>\n        );\n      }\n      return <FileLinks>{this.renderFileLink(value)}</FileLinks>;\n    };\n\n    renderImages = () => {\n      const { getAsset, value } = this.props;\n      if (isMultiple(value)) {\n        return (\n          <MultiImageWrapper>\n            {value.map(val => (\n              <ImageWrapper key={val}>\n                <Image src={getAsset(val)} />\n              </ImageWrapper>\n            ))}\n          </MultiImageWrapper>\n        );\n      }\n      return (\n        <ImageWrapper>\n          <Image src={getAsset(value)} />\n        </ImageWrapper>\n      );\n    };\n\n    renderSelection = subject => (\n      <div>\n        {forImage ? this.renderImages() : null}\n        <div>\n          {forImage ? null : this.renderFileLinks()}\n          <FileWidgetButton onClick={this.handleChange}>\n            Choose different {subject}\n          </FileWidgetButton>\n          <FileWidgetButtonRemove onClick={this.handleRemove}>\n            Remove {subject}\n          </FileWidgetButtonRemove>\n        </div>\n      </div>\n    );\n\n    renderNoSelection = (subject, article) => (\n      <FileWidgetButton onClick={this.handleChange}>\n        Choose {article} {subject}\n      </FileWidgetButton>\n    );\n\n    render() {\n      const { value, classNameWrapper } = this.props;\n      const subject = forImage ? 'image' : 'file';\n      const article = forImage ? 'an' : 'a';\n\n      return (\n        <div className={classNameWrapper}>\n          <span>\n            {value ? this.renderSelection(subject) : this.renderNoSelection(subject, article)}\n          </span>\n        </div>\n      );\n    }\n  };\n}\n"],"file":"withFileControl.js"}