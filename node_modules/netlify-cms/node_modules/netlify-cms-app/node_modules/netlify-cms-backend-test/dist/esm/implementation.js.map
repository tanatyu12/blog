{"version":3,"sources":["../../src/implementation.js"],"names":["window","repoFiles","repoFilesUnpublished","getFile","path","segments","split","obj","length","shift","pageSize","getCursor","collection","extension","entries","index","count","pageCount","Math","floor","Cursor","create","actions","meta","data","getFolderEntries","folder","Object","keys","filter","endsWith","map","file","content","reverse","TestBackend","constructor","config","options","assets","authComponent","AuthenticationPage","restoreUser","user","authenticate","Promise","resolve","logout","getToken","traverseCursor","cursor","action","toObject","newIndex","allEntries","get","slice","newCursor","entriesByFolder","ret","CURSOR_COMPATIBILITY_SYMBOL","entriesByFiles","files","collectionFile","label","all","getEntry","slug","unpublishedEntries","unpublishedEntry","entry","find","e","metaData","reject","EditorialWorkflowError","deleteUnpublishedEntry","unpubStore","existingEntryIndex","findIndex","splice","persistEntry","mediaFiles","raw","useWorkflow","unpubEntry","title","parsedData","description","collectionName","status","initialWorkflowStatus","push","newEntry","substring","lastIndexOf","fileName","updateUnpublishedEntryStatus","newStatus","entryIndex","publishUnpublishedEntry","unpubEntryIndex","getMedia","persistMedia","fileObj","name","size","objectUrl","URL","createObjectURL","url","normalizedAsset","id","deleteFile","assetIndex","asset"],"mappings":"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","sourcesContent":["import { attempt, isError, take } from 'lodash';\nimport uuid from 'uuid/v4';\nimport { EditorialWorkflowError, Cursor, CURSOR_COMPATIBILITY_SYMBOL } from 'netlify-cms-lib-util';\nimport AuthenticationPage from './AuthenticationPage';\n\nwindow.repoFiles = window.repoFiles || {};\nwindow.repoFilesUnpublished = window.repoFilesUnpublished || [];\n\nfunction getFile(path) {\n  const segments = path.split('/');\n  let obj = window.repoFiles;\n  while (obj && segments.length) {\n    obj = obj[segments.shift()];\n  }\n  return obj || {};\n}\n\nconst pageSize = 10;\n\nconst getCursor = (collection, extension, entries, index) => {\n  const count = entries.length;\n  const pageCount = Math.floor(count / pageSize);\n  return Cursor.create({\n    actions: [\n      ...(index < pageCount ? ['next', 'last'] : []),\n      ...(index > 0 ? ['prev', 'first'] : []),\n    ],\n    meta: { index, count, pageSize, pageCount },\n    data: { collection, extension, index, pageCount },\n  });\n};\n\nconst getFolderEntries = (folder, extension) => {\n  return Object.keys(window.repoFiles[folder] || {})\n    .filter(path => path.endsWith(`.${extension}`))\n    .map(path => ({\n      file: { path: `${folder}/${path}` },\n      data: window.repoFiles[folder][path].content,\n    }))\n    .reverse();\n};\n\nexport default class TestBackend {\n  constructor(config, options = {}) {\n    this.config = config;\n    this.assets = [];\n    this.options = options;\n  }\n\n  authComponent() {\n    return AuthenticationPage;\n  }\n\n  restoreUser(user) {\n    return this.authenticate(user);\n  }\n\n  authenticate() {\n    return Promise.resolve();\n  }\n\n  logout() {\n    return null;\n  }\n\n  getToken() {\n    return Promise.resolve('');\n  }\n\n  traverseCursor(cursor, action) {\n    const { collection, extension, index, pageCount } = cursor.data.toObject();\n    const newIndex = (() => {\n      if (action === 'next') {\n        return index + 1;\n      }\n      if (action === 'prev') {\n        return index - 1;\n      }\n      if (action === 'first') {\n        return 0;\n      }\n      if (action === 'last') {\n        return pageCount;\n      }\n    })();\n    // TODO: stop assuming cursors are for collections\n    const allEntries = getFolderEntries(collection.get('folder'), extension);\n    const entries = allEntries.slice(newIndex * pageSize, newIndex * pageSize + pageSize);\n    const newCursor = getCursor(collection, extension, allEntries, newIndex);\n    return Promise.resolve({ entries, cursor: newCursor });\n  }\n\n  entriesByFolder(collection, extension) {\n    const folder = collection.get('folder');\n    const entries = folder ? getFolderEntries(folder, extension) : [];\n    const cursor = getCursor(collection, extension, entries, 0);\n    const ret = take(entries, pageSize);\n    ret[CURSOR_COMPATIBILITY_SYMBOL] = cursor;\n    return Promise.resolve(ret);\n  }\n\n  entriesByFiles(collection) {\n    const files = collection.get('files').map(collectionFile => ({\n      path: collectionFile.get('file'),\n      label: collectionFile.get('label'),\n    }));\n    return Promise.all(\n      files.map(file => ({\n        file,\n        data: getFile(file.path).content,\n      })),\n    );\n  }\n\n  getEntry(collection, slug, path) {\n    return Promise.resolve({\n      file: { path },\n      data: getFile(path).content,\n    });\n  }\n\n  unpublishedEntries() {\n    return Promise.resolve(window.repoFilesUnpublished);\n  }\n\n  unpublishedEntry(collection, slug) {\n    const entry = window.repoFilesUnpublished.find(\n      e => e.metaData.collection === collection.get('name') && e.slug === slug,\n    );\n    if (!entry) {\n      return Promise.reject(\n        new EditorialWorkflowError('content is not under editorial workflow', true),\n      );\n    }\n    return Promise.resolve(entry);\n  }\n\n  deleteUnpublishedEntry(collection, slug) {\n    const unpubStore = window.repoFilesUnpublished;\n    const existingEntryIndex = unpubStore.findIndex(\n      e => e.metaData.collection === collection && e.slug === slug,\n    );\n    unpubStore.splice(existingEntryIndex, 1);\n    return Promise.resolve();\n  }\n\n  persistEntry({ path, raw, slug }, mediaFiles, options = {}) {\n    if (options.useWorkflow) {\n      const unpubStore = window.repoFilesUnpublished;\n      const existingEntryIndex = unpubStore.findIndex(e => e.file.path === path);\n      if (existingEntryIndex >= 0) {\n        const unpubEntry = { ...unpubStore[existingEntryIndex], data: raw };\n        unpubEntry.title = options.parsedData && options.parsedData.title;\n        unpubEntry.description = options.parsedData && options.parsedData.description;\n        unpubStore.splice(existingEntryIndex, 1, unpubEntry);\n      } else {\n        const unpubEntry = {\n          data: raw,\n          file: {\n            path,\n          },\n          metaData: {\n            collection: options.collectionName,\n            status: this.options.initialWorkflowStatus,\n            title: options.parsedData && options.parsedData.title,\n            description: options.parsedData && options.parsedData.description,\n          },\n          slug,\n        };\n        unpubStore.push(unpubEntry);\n      }\n      return Promise.resolve();\n    }\n\n    const newEntry = options.newEntry || false;\n    const folder = path.substring(0, path.lastIndexOf('/'));\n    const fileName = path.substring(path.lastIndexOf('/') + 1);\n    window.repoFiles[folder] = window.repoFiles[folder] || {};\n    window.repoFiles[folder][fileName] = window.repoFiles[folder][fileName] || {};\n    if (newEntry) {\n      window.repoFiles[folder][fileName] = { content: raw };\n    } else {\n      window.repoFiles[folder][fileName].content = raw;\n    }\n    return Promise.resolve();\n  }\n\n  updateUnpublishedEntryStatus(collection, slug, newStatus) {\n    const unpubStore = window.repoFilesUnpublished;\n    const entryIndex = unpubStore.findIndex(\n      e => e.metaData.collection === collection && e.slug === slug,\n    );\n    unpubStore[entryIndex].metaData.status = newStatus;\n    return Promise.resolve();\n  }\n\n  publishUnpublishedEntry(collection, slug) {\n    const unpubStore = window.repoFilesUnpublished;\n    const unpubEntryIndex = unpubStore.findIndex(\n      e => e.metaData.collection === collection && e.slug === slug,\n    );\n    const unpubEntry = unpubStore[unpubEntryIndex];\n    const entry = { raw: unpubEntry.data, slug: unpubEntry.slug, path: unpubEntry.file.path };\n    unpubStore.splice(unpubEntryIndex, 1);\n    return this.persistEntry(entry);\n  }\n  getMedia() {\n    return Promise.resolve(this.assets);\n  }\n\n  persistMedia({ fileObj }) {\n    const { name, size } = fileObj;\n    const objectUrl = attempt(window.URL.createObjectURL, fileObj);\n    const url = isError(objectUrl) ? '' : objectUrl;\n    const normalizedAsset = { id: uuid(), name, size, path: url, url };\n\n    this.assets.push(normalizedAsset);\n    return Promise.resolve(normalizedAsset);\n  }\n\n  deleteFile(path) {\n    const assetIndex = this.assets.findIndex(asset => asset.path === path);\n    if (assetIndex > -1) {\n      this.assets.splice(assetIndex, 1);\n    } else {\n      const folder = path.substring(0, path.lastIndexOf('/'));\n      const fileName = path.substring(path.lastIndexOf('/') + 1);\n      delete window.repoFiles[folder][fileName];\n    }\n\n    return Promise.resolve();\n  }\n}\n"],"file":"implementation.js"}